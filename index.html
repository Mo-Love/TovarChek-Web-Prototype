<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú—ñ–π –°–∫–ª–∞–¥ (Local)</title>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            padding: 15px;
            background-color: #f0f2f5;
            text-align: center;
        }
        h2 { margin-bottom: 10px; color: #333; }
        
        /* –°—Ç–∏–ª—ñ –¥–ª—è –∫–∞–º–µ—Ä–∏ */
        #reader {
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
            border-radius: 10px;
            overflow: hidden;
            background: #000;
        }

        /* –ö–Ω–æ–ø–∫–∏ */
        button {
            padding: 12px 24px;
            font-size: 16px;
            margin: 10px 5px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.2s;
        }
        .btn-scan { background-color: #007bff; color: white; }
        .btn-stop { background-color: #dc3545; color: white; display: none; }
        .btn-clear { background-color: #6c757d; color: white; margin-top: 20px;}

        /* –¢–∞–±–ª–∏—Ü—è */
        .table-container {
            margin-top: 20px;
            overflow-x: auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th { background-color: #f8f9fa; color: #555; }
        tr:last-child td { border-bottom: none; }
        
        /* –ê–Ω—ñ–º–∞—Ü—ñ—è –ø–æ—è–≤–∏ –Ω–æ–≤–æ–≥–æ —Ä—è–¥–∫–∞ */
        .new-row {
            animation: highlight 1.5s ease-out;
        }
        @keyframes highlight {
            0% { background-color: #d4edda; }
            100% { background-color: white; }
        }
    </style>
</head>
<body>

    <h2>üì¶ –°–∫–ª–∞–¥ (–¢–µ—Å—Ç)</h2>

    <div id="reader"></div>

    <button id="startBtn" class="btn-scan" onclick="startScanning()">üì∑ –°–∫–∞–Ω—É–≤–∞—Ç–∏</button>
    <button id="stopBtn" class="btn-stop" onclick="stopScanning()">‚èπ –°—Ç–æ–ø</button>

    <div class="table-container">
        <table id="inventoryTable">
            <thead>
                <tr>
                    <th>–ß–∞—Å</th>
                    <th>–®—Ç—Ä–∏—Ö-–∫–æ–¥</th>
                </tr>
            </thead>
            <tbody id="tableBody">
                </tbody>
        </table>
    </div>

    <button class="btn-clear" onclick="clearHistory()">üóë –û—á–∏—Å—Ç–∏—Ç–∏ —ñ—Å—Ç–æ—Ä—ñ—é</button>

    <script>
        const html5QrCode = new Html5Qrcode("reader");
        let isScanning = false;

        // 1. –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö –¥–∞–Ω–∏—Ö –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ
        window.onload = function() {
            renderTable();
        };

        // 2. –§—É–Ω–∫—Ü—ñ—è –∑–∞–ø—É—Å–∫—É –∫–∞–º–µ—Ä–∏
        function startScanning() {
            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('stopBtn').style.display = 'inline-block';
            
            const config = { fps: 10, qrbox: { width: 250, height: 250 } };
            
            // –ù–∞–º–∞–≥–∞—î–º–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç–∏ –∑–∞–¥–Ω—é –∫–∞–º–µ—Ä—É
            html5QrCode.start({ facingMode: "environment" }, config, onScanSuccess)
            .catch(err => {
                alert("–ü–æ–º–∏–ª–∫–∞ –∫–∞–º–µ—Ä–∏: " + err);
                stopScanning();
            });
        }

        // 3. –§—É–Ω–∫—Ü—ñ—è –∑—É–ø–∏–Ω–∫–∏
        function stopScanning() {
            html5QrCode.stop().then(() => {
                document.getElementById('startBtn').style.display = 'inline-block';
                document.getElementById('stopBtn').style.display = 'none';
                console.log("–ö–∞–º–µ—Ä–∞ –∑—É–ø–∏–Ω–µ–Ω–∞");
            }).catch(err => console.log(err));
        }

        // 4. –©–æ —Ä–æ–±–∏—Ç–∏, –∫–æ–ª–∏ –∑–Ω–∞–π—à–ª–∏ –∫–æ–¥
        function onScanSuccess(decodedText, decodedResult) {
            // –ó—É–ø–∏–Ω—è—î–º–æ –∫–∞–º–µ—Ä—É, —â–æ–± –Ω–µ —Å–∫–∞–Ω—É–≤–∞—Ç–∏ —Ç–æ–π —Å–∞–º–∏–π –∫–æ–¥ 10 —Ä–∞–∑—ñ–≤ –∑–∞ —Å–µ–∫—É–Ω–¥—É
            stopScanning();
            
            // –ó–≤—É–∫ "–ø—ñ–∫" (–≤—ñ–±—Ä–∞—Ü—ñ—è)
            if (navigator.vibrate) navigator.vibrate(200);
            
            saveData(decodedText);
            alert("‚úÖ –ó–Ω–∞–π–¥–µ–Ω–æ: " + decodedText);
        }

        // 5. –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ –ø–∞–º'—è—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω—É (LocalStorage)
        function saveData(code) {
            let data = JSON.parse(localStorage.getItem('myInventory')) || [];
            
            const newItem = {
                code: code,
                time: new Date().toLocaleTimeString('uk-UA', {hour: '2-digit', minute:'2-digit'})
            };

            // –î–æ–¥–∞—î–º–æ –Ω–∞ –ø–æ—á–∞—Ç–æ–∫ —Å–ø–∏—Å–∫—É
            data.unshift(newItem);
            
            localStorage.setItem('myInventory', JSON.stringify(data));
            renderTable();
        }

        // 6. –ú–∞–ª—é–≤–∞–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—ñ
        function renderTable() {
            const data = JSON.parse(localStorage.getItem('myInventory')) || [];
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            data.forEach((item, index) => {
                let row = document.createElement('tr');
                if(index === 0) row.classList.add('new-row'); // –ü—ñ–¥—Å–≤—ñ—Ç–∏—Ç–∏ –æ—Å—Ç–∞–Ω–Ω—ñ–π
                row.innerHTML = `<td>${item.time}</td><td><b>${item.code}</b></td>`;
                tbody.appendChild(row);
            });
        }

        // 7. –û—á–∏—â–µ–Ω–Ω—è
        function clearHistory() {
            if(confirm('–í–∏–¥–∞–ª–∏—Ç–∏ –≤—Å—é —ñ—Å—Ç–æ—Ä—ñ—é —Å–∫–∞–Ω—É–≤–∞–Ω—å?')) {
                localStorage.removeItem('myInventory');
                renderTable();
            }
        }
    </script>

</body>
</html>
